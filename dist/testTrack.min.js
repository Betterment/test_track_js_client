!function(t,i){if("function"==typeof define&&define.amd)define(["node-uuid","blueimp-md5","jquery","base-64","jquery.cookie"],i);else if("undefined"!=typeof exports){var e=require("node-uuid"),n=require("blueimp-md5"),r=require("jquery"),s=require("base-64");require("jquery.cookie");module.exports=i(e,n,r,s)}else t.TestTrack=i(t.uuid,t.md5,t.jQuery,t.base64)}(this,function(t,i,e,n){"use strict";if(void 0===t)throw new Error('TestTrack depends on node-uuid. Make sure you are including "node_modules/node-uuid/uuid.js"');if(void 0===i)throw new Error('TestTrack depends on blueimp-md5. Make sure you are including "node_modules/blueimp-md5/js/md5.js"');if(void 0===e)throw new Error('TestTrack depends on jquery. You can use your own copy of jquery or the one in "node_modules/jquery/dist/jquery.js"');if("function"!=typeof e.cookie)throw new Error("TestTrack depends on jquery.cookie. You can user your own copy of jquery.cooke or the one in node_modules/jquery.cookie/jquery.cookie.js");if(void 0===n)throw new Error('TestTrack depends on base-64. Make sure you are including "node_modules/base-64/base64.js"');Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var i=Array.prototype.slice.call(arguments,1),e=this,n=function(){},r=function(){return e.apply(this instanceof n?this:t,i.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(n.prototype=this.prototype),r.prototype=new n,r});var r=function(){var t=function(){};return t.prototype.trackAssignment=function(t,i,e){var n={TTVisitorID:t,SplitName:i.getSplitName(),SplitVariant:i.getVariant(),SplitContext:i.getContext()};window.mixpanel&&window.mixpanel.track("SplitAssigned",n,e)},t.prototype.identify=function(t){window.mixpanel&&window.mixpanel.identify(t)},t.prototype.alias=function(t){window.mixpanel&&window.mixpanel.alias(t)},t}(),s=function(){var t=function(t){if(!t.splitName)throw new Error("must provide splitName");if(!t.hasOwnProperty("variant"))throw new Error("must provide variant");if(!t.hasOwnProperty("isUnsynced"))throw new Error("must provide isUnsynced");this._splitName=t.splitName,this._variant=t.variant,this._context=t.context,this._isUnsynced=t.isUnsynced};return t.fromJsonArray=function(t){for(var i=[],e=0;e<t.length;e++)i.push(new s({splitName:t[e].split_name,variant:t[e].variant,context:t[e].context,isUnsynced:t[e].unsynced}));return i},t.prototype.getSplitName=function(){return this._splitName},t.prototype.getVariant=function(){return this._variant},t.prototype.setVariant=function(t){this._variant=t},t.prototype.getContext=function(){return this._context},t.prototype.setContext=function(t){this._context=t},t.prototype.isUnsynced=function(){return this._isUnsynced},t.prototype.setUnsynced=function(t){this._isUnsynced=t},t}(),o=function(){var t=function(){};return t.prototype.getConfig=function(){return"function"==typeof window.atob?JSON.parse(window.atob(window.TT)):JSON.parse(n.decode(window.TT))},t}(),a=function(){var t,i,e=function(){if(!t){var i=new o;t=i.getConfig()}return t};return{_clear:function(){t=null},getUrl:function(){return e().url},getCookieDomain:function(){return e().cookieDomain},getCookieName:function(){return e().cookieName||"tt_visitor_id"},getSplitRegistry:function(){return e().registry},getAssignments:function(){var t=e().assignments;if(!t)return null;if(!i){i=[];for(var n in t)i.push(new s({splitName:n,variant:t[n],isUnsynced:!1}))}return i}}}(),u=function(){var t=function(t){if(this.visitor=t.visitor,this.splitName=t.splitName,!this.visitor)throw new Error("must provide visitor");if(!this.splitName)throw new Error("must provide splitName")};return t.prototype.getVariant=function(){if(!a.getSplitRegistry())return null;for(var t=0,i=this.getAssignmentBucket(),e=this.getWeighting(),n=this.getSortedVariants(),r=0;r<n.length;r++){var s=n[r];if((t+=e[s])>i)return s}throw new Error("Assignment bucket out of range. "+i+" unmatched in "+this.splitName+": "+JSON.stringify(e))},t.prototype.getSplitVisitorHash=function(){return i(this.splitName+this.visitor.getId())},t.prototype.getHashFixnum=function(){return parseInt(this.getSplitVisitorHash().substr(0,8),16)},t.prototype.getAssignmentBucket=function(){return this.getHashFixnum()%100},t.prototype.getSortedVariants=function(){return this.getVariants().sort()},t.prototype.getVariants=function(){return Object.getOwnPropertyNames(this.getWeighting())},t.prototype.getWeighting=function(){var t=a.getSplitRegistry()[this.splitName];if(!t){var i='Unknown split: "'+this.splitName+'"';throw this.visitor.logError(i),new Error(i)}return t},t}(),p=function(){var t=function(t){if(t=t||{},this._visitor=t.visitor,this._assignment=t.assignment,!this._visitor)throw new Error("must provide visitor");if(!this._assignment)throw new Error("must provide assignment")};return t.prototype.send=function(){this.persistAssignment(),this._visitor.analytics.trackAssignment(this._visitor.getId(),this._assignment,function(t){this.persistAssignment(t?"success":"failure")}.bind(this))},t.prototype.persistAssignment=function(t){return e.ajax(a.getUrl()+"/api/v1/assignment_event",{method:"POST",dataType:"json",crossDomain:!0,data:{visitor_id:this._visitor.getId(),split_name:this._assignment.getSplitName(),context:this._assignment.getContext(),mixpanel_result:t}}).fail(function(t,i,e){var n=t&&t.status,r=t&&t.responseText;this._visitor.logError("test_track persistAssignment error: "+[t,n,r,i,e].join(", "))}.bind(this))},t}(),f=function(){var t=function(t){if(t=t||{},this._visitor=t.visitor,this._assignment=t.assignment,this._username=t.username,this._password=t.password,!this._visitor)throw new Error("must provide visitor");if(!this._assignment)throw new Error("must provide assignment");if(!this._username)throw new Error("must provide username");if(!this._password)throw new Error("must provide password")};return t.prototype.send=function(){this.persistAssignment(),this._visitor.analytics.trackAssignment(this._visitor.getId(),this._assignment,function(t){this.persistAssignment(t?"success":"failure")}.bind(this))},t.prototype.persistAssignment=function(t){return e.ajax(a.getUrl()+"/api/v1/assignment_override",{method:"POST",dataType:"json",crossDomain:!0,headers:{Authorization:"Basic "+btoa(this._username+":"+this._password)},data:{visitor_id:this._visitor.getId(),split_name:this._assignment.getSplitName(),variant:this._assignment.getVariant(),context:this._assignment.getContext(),mixpanel_result:t}}).fail(function(t,i,e){var n=t&&t.status,r=t&&t.responseText;this._visitor.logError("test_track persistAssignment error: "+[t,n,r,i,e].join(", "))}.bind(this))},t}(),h=function(){var i=function(t){if(t=t||{},this._id=t.id,this._assignments=t.assignments,this._ttOffline=t.ttOffline,!this._id)throw new Error("must provide id");if(!this._assignments)throw new Error("must provide assignments");this._errorLogger=function(t){window.console.error(t)},this.analytics=new r};return i.loadVisitor=function(i){var n=e.Deferred(),r=function(t){n.resolve(new h(t))};return i?a.getAssignments()?r({id:i,assignments:a.getAssignments(),ttOffline:!1}):e.ajax(a.getUrl()+"/api/v1/visitors/"+i,{method:"GET",timeout:5e3}).done(function(t){r({id:t.id,assignments:s.fromJsonArray(t.assignments),ttOffline:!1})}).fail(function(){r({id:i,assignments:[],ttOffline:!0})}):r({id:t.v4(),assignments:[],ttOffline:!1}),n.promise()},i.prototype.getId=function(){return this._id},i.prototype.getAssignmentRegistry=function(){if(!this._assignmentRegistry){for(var t={},i=0;i<this._assignments.length;i++){var e=this._assignments[i];t[e.getSplitName()]=e}this._assignmentRegistry=t}return this._assignmentRegistry},i.prototype.vary=function(t,i){if("object"!=typeof i.variants)throw new Error("must provide variants object to `vary` for "+t);if(!i.context)throw new Error("must provide context to `vary` for "+t);if(!i.defaultVariant&&!1!==i.defaultVariant)throw new Error("must provide defaultVariant to `vary` for "+t);var e=i.defaultVariant.toString(),n=i.variants,r=i.context;if(!n.hasOwnProperty(e))throw new Error("defaultVariant: "+e+" must be represented in variants object");var s=this._getAssignmentFor(t,r),o=new c({assignment:s,visitor:this});for(var a in n)n.hasOwnProperty(a)&&(a===e?o.default(a,n[a]):o.when(a,n[a]));o.run(),o.isDefaulted()&&(s.setVariant(o.getDefaultVariant()),s.setUnsynced(!0),s.setContext(r)),this.notifyUnsyncedAssignments()},i.prototype.ab=function(t,i){var e=new l({splitName:t,trueVariant:i.trueVariant,visitor:this}).getVariants(),n={};n[e.true]=function(){i.callback(!0)},n[e.false]=function(){i.callback(!1)},this.vary(t,{context:i.context,variants:n,defaultVariant:e.false})},i.prototype.setErrorLogger=function(t){if("function"!=typeof t)throw new Error("must provide function for errorLogger");this._errorLogger=t},i.prototype.logError=function(t){this._errorLogger.call(null,t)},i.prototype.linkIdentifier=function(t,i){var n=e.Deferred();return new g({visitorId:this.getId(),identifierType:t,value:i}).save().then(function(t){this._merge(t),this.notifyUnsyncedAssignments(),n.resolve()}.bind(this)),n.promise()},i.prototype.setAnalytics=function(t){if("object"!=typeof t)throw new Error("must provide object for setAnalytics");this.analytics=t},i.prototype.notifyUnsyncedAssignments=function(){for(var t=this._getUnsyncedAssignments(),i=0;i<t.length;i++)this._notify(t[i])},i.prototype._getUnsyncedAssignments=function(){var t=[],i=this.getAssignmentRegistry();return Object.keys(i).forEach(function(e){var n=i[e];n.isUnsynced()&&t.push(n)}),t},i.prototype._merge=function(t){var i=this.getAssignmentRegistry(),e=t.getAssignmentRegistry();this._id=t.getId();for(var n in e)e.hasOwnProperty(n)&&(i[n]=e[n])},i.prototype._getAssignmentFor=function(t,i){return this.getAssignmentRegistry()[t]||this._generateAssignmentFor(t,i)},i.prototype._generateAssignmentFor=function(t,i){var e=new u({visitor:this,splitName:t}).getVariant();e||(this._ttOffline=!0);var n=new s({splitName:t,variant:e,context:i,isUnsynced:!0});return this._assignments.push(n),this._assignmentRegistry=null,n},i.prototype._notify=function(t){try{if(this._ttOffline)return;new p({visitor:this,assignment:t}).send(),t.setUnsynced(!1)}catch(t){this.logError("test_track notify error: "+t)}},i}(),d=function(){var t=function(){this._visitorDeferred=e.Deferred()};return t.prototype.initialize=function(t){var i=e.cookie(a.getCookieName());this._visitorDeferred.then(function(t){t.notifyUnsyncedAssignments()}),h.loadVisitor(i).then(function(i){t&&t.analytics&&i.setAnalytics(t.analytics),t&&t.errorLogger&&i.setErrorLogger(t.errorLogger),t&&"function"==typeof t.onVisitorLoaded&&t.onVisitorLoaded.call(null,i),this._visitorDeferred.resolve(i)}.bind(this)),this._setCookie()},t.prototype.vary=function(t,i){this._visitorDeferred.then(function(e){e.vary(t,i)})},t.prototype.ab=function(t,i){this._visitorDeferred.then(function(e){e.ab(t,i)})},t.prototype.logIn=function(t,i){var n=e.Deferred();return this._visitorDeferred.then(function(e){e.linkIdentifier(t,i).then(function(){this._setCookie(),e.analytics.identify(e.getId()),n.resolve()}.bind(this))}.bind(this)),n.promise()},t.prototype.signUp=function(t,i){var n=e.Deferred();return this._visitorDeferred.then(function(e){e.linkIdentifier(t,i).then(function(){this._setCookie(),e.analytics.alias(e.getId()),n.resolve()}.bind(this))}.bind(this)),n.promise()},t.prototype._setCookie=function(){this._visitorDeferred.then(function(t){e.cookie(a.getCookieName(),t.getId(),{expires:365,path:"/",domain:a.getCookieDomain()})})},t.prototype.getPublicAPI=function(){return{vary:this.vary.bind(this),ab:this.ab.bind(this),logIn:this.logIn.bind(this),signUp:this.signUp.bind(this),initialize:this.initialize.bind(this),_crx:{loadInfo:function(){var t=e.Deferred();return this._visitorDeferred.then(function(i){var e={};for(var n in i.getAssignmentRegistry())e[n]=i.getAssignmentRegistry()[n].getVariant();t.resolve({visitorId:i.getId(),splitRegistry:a.getSplitRegistry(),assignmentRegistry:e})}),t.promise()}.bind(this),persistAssignment:function(t,i,n,r){var o=e.Deferred();return this._visitorDeferred.then(function(e){new f({visitor:e,username:n,password:r,assignment:new s({splitName:t,variant:i,context:"chrome_extension",isUnsynced:!0})}).persistAssignment().then(function(){o.resolve()})}),o.promise()}.bind(this)}}},t}(),g=function(){var t=function(t){if(this.visitorId=t.visitorId,this.identifierType=t.identifierType,this.value=t.value,!this.visitorId)throw new Error("must provide visitorId");if(!this.identifierType)throw new Error("must provide identifierType");if(!this.value)throw new Error("must provide value")};return t.prototype.save=function(t,i){var n=e.Deferred();return e.ajax(a.getUrl()+"/api/v1/identifier",{method:"POST",dataType:"json",crossDomain:!0,data:{identifier_type:this.identifierType,value:this.value,visitor_id:this.visitorId}}).then(function(t){var i=new h({id:t.visitor.id,assignments:s.fromJsonArray(t.visitor.assignments)});n.resolve(i)}),n.promise()},t}(),c=function(){var t=function(t){if(!t.assignment)throw new Error("must provide assignment");if(!t.visitor)throw new Error("must provide visitor");this._assignment=t.assignment,this._visitor=t.visitor,this._splitRegistry=a.getSplitRegistry(),this._variantHandlers={}};return t.prototype.when=function(){var t=Array.prototype.slice.call(arguments,0),i=t.length-1,e="function"!=typeof t[0]&&t.length>0?t.slice(0,Math.max(1,i)):[],n=t[i];if(0===e.length)throw new Error("must provide at least one variant");for(var r=0;r<e.length;r++)this._assignHandlerToVariant(e[r],n)},t.prototype.default=function(t,i){if(this._defaultVariant)throw new Error("must provide exactly one `default`");this._defaultVariant=this._assignHandlerToVariant(t,i)},t.prototype.run=function(){this._validate();var t;this._variantHandlers[this._assignment.getVariant()]?t=this._variantHandlers[this._assignment.getVariant()]:(t=this._variantHandlers[this.getDefaultVariant()],this._defaulted=!0),t()},t.prototype.isDefaulted=function(){return this._defaulted||!1},t.prototype.getDefaultVariant=function(){return this._defaultVariant},t.prototype._assignHandlerToVariant=function(t,i){if("function"!=typeof i)throw new Error("must provide handler for "+t);return t=t.toString(),this._getSplit()&&!this._getSplit().hasOwnProperty(t)&&this._visitor.logError("configures unknown variant "+t),this._variantHandlers[t]=i,t},t.prototype._validate=function(){if(!this.getDefaultVariant())throw new Error("must provide exactly one `default`");if(this._getVariants().length<2)throw new Error("must provide at least one `when`");if(this._getSplit()){var t=this._getMissingVariants();if(t.length>0){var i=t.join(", ").replace(/, (.+)$/," and $1");this._visitor.logError("does not configure variants "+i)}}},t.prototype._getSplit=function(){return this._splitRegistry?this._splitRegistry[this._assignment.getSplitName()]:null},t.prototype._getVariants=function(){return Object.getOwnPropertyNames(this._variantHandlers)},t.prototype._getMissingVariants=function(){for(var t=this._getVariants(),i=this._getSplit(),e=Object.getOwnPropertyNames(i),n=[],r=0;r<e.length;r++){var s=e[r];-1===t.indexOf(s)&&n.push(s)}return n},t}(),l=function(){var t=function(t){if(!t.splitName)throw new Error("must provide splitName");if(!t.hasOwnProperty("trueVariant"))throw new Error("must provide trueVariant");if(!t.visitor)throw new Error("must provide visitor");this._splitName=t.splitName,this._trueVariant=t.trueVariant,this._visitor=t.visitor,this._splitRegistry=a.getSplitRegistry()};return t.prototype.getVariants=function(){var t=this._getSplitVariants();return t&&t.length>2&&this._visitor.logError("A/B for "+this._splitName+" configures split with more than 2 variants"),{true:this._getTrueVariant(),false:this._getFalseVariant()}},t.prototype._getTrueVariant=function(){return this._trueVariant||!0},t.prototype._getFalseVariant=function(){var t=this._getNonTrueVariants();return!!t&&t.sort()[0]},t.prototype._getNonTrueVariants=function(){var t=this._getSplitVariants();if(t){var i=this._getTrueVariant(),e=t.indexOf(i);return-1!==e&&t.splice(e,1),t}return null},t.prototype._getSplit=function(){return this._splitRegistry?this._splitRegistry[this._splitName]:null},t.prototype._getSplitVariants=function(){return this._getSplit()&&Object.getOwnPropertyNames(this._getSplit())},t}(),v=(new d).getPublicAPI(),m=function(){window.dispatchEvent(new CustomEvent("tt:lib:loaded",{detail:{TestTrack:v}}))};try{e(document).ready(function(){e(document.body).addClass("_tt");try{window.dispatchEvent(new CustomEvent("tt:class:added"))}catch(t){}}),m(),window.addEventListener("tt:listener:ready",m)}catch(t){}return v});